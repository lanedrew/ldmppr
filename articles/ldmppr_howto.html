<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example `ldmppr` Workflow on Simulated Data • ldmppr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example `ldmppr` Workflow on Simulated Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ldmppr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ldmppr_howto.html">Example `ldmppr` Workflow on Simulated Data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lanedrew/ldmppr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Example `ldmppr` Workflow on Simulated Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lanedrew/ldmppr/blob/master/vignettes/ldmppr_howto.Rmd" class="external-link"><code>vignettes/ldmppr_howto.Rmd</code></a></small>
      <div class="d-none name"><code>ldmppr_howto.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lanedrew/ldmppr" class="external-link">ldmppr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>To illustrate the use of the <code>ldmppr</code> package, we will be
using the included <code>small_example_data</code> dataset. This dataset
consists of locations and sizes for points in a (25m x 25m) square
domain.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"small_example_data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">small_example_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 121</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">small_example_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;           x          y     size</span></span>
<span><span class="co">#&gt; 1 10.000000 14.0000000 900.7306</span></span>
<span><span class="co">#&gt; 2  5.636737 20.3068181 523.1122</span></span>
<span><span class="co">#&gt; 3 24.086291  6.2358462 519.3012</span></span>
<span><span class="co">#&gt; 4 21.191344 14.0034707 490.1228</span></span>
<span><span class="co">#&gt; 5 14.742128  0.3113149 400.2289</span></span>
<span><span class="co">#&gt; 6 20.160199  3.6875049 395.8505</span></span></code></pre></div>
<p>We also include a collection of example raster files obtained from an
ESS-DIVE repository (see the help file for
<code>small_example_data</code> for details).</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>ldmppr</code> package provides tools for:</p>
<ol style="list-style-type: decimal">
<li>estimating a mechanistic spatio-temporal point process model for a
reference marked point pattern (by mapping marks to event times),</li>
<li>training a mark model that relates covariates (and optional
competition indices) to marks,</li>
<li>checking model fit using non-parametric summaries and global
envelope tests, and</li>
<li>simulating from the fitted model.</li>
</ol>
<p>As of version <code>1.1.0</code>, the main workflow functions return
<strong>S3 objects</strong> with standard methods (<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>,
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code>, <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code>,
etc.). In most cases you should no longer need helper plotting functions
like <code><a href="../reference/plot_mpp.html">plot_mpp()</a></code>.</p>
<hr>
</div>
<div class="section level2">
<h2 id="example-workflow">Example workflow<a class="anchor" aria-label="anchor" href="#example-workflow"></a>
</h2>
<div class="section level3">
<h3 id="step-1-estimate-the-point-process-parameters">Step 1: Estimate the point process parameters<a class="anchor" aria-label="anchor" href="#step-1-estimate-the-point-process-parameters"></a>
</h3>
<p>We start by estimating the parameters of a self-correcting
spatio-temporal point process using the
<code>estimate_process_parameters</code> function. This function makes
use of user specified optimization algorithms in the <code>nloptr</code>
function to perform estimation through log-likelihood optimization. The
function can be run with three different optimization strategies
<code>("local", "global_local", "multires_global_local")</code> that
allow the user to control the approach. The <code>"local"</code>
strategy performs a local optimization, where the
<code>"global_local"</code> first runs a global optimization and then
uses the solution as a starting point for a local optimization. Finally,
the <code>"multires_global_local"</code> strategy performs similarly to
the <code>"global_local"</code>, but iterates further at the local level
by increasing the resolution of the spatio-temporal grid and repeating
the local optimization with increasing degrees of polish. The function
requires the observed locations and observed arrival times, which are
generated from the observed sizes using a power law mapping function.
These inputs are accepted as:</p>
<ul>
<li>a matrix/data.frame with columns <code>(time, x, y)</code>,
<strong>or</strong>
</li>
<li>a matrix/data.frame with columns <code>(x, y, size)</code> plus a
mapping hyperparameter <code>delta</code> (or a vector
<code>delta_values</code> for a delta-search).</li>
</ul>
<p>The power law mapping function depends on the hyperparameter
<code>delta</code>, which controls the shape of the mapping relationship
between sizes and arrival times. The function also requires the grid
values for the optimization process, the initial parameter values, the
upper bounds for the parameters, and the optimization algorithm (either
global and local, or just local depending on strategy) to use. The
function returns the optimal parameter estimates for the self-correcting
point process.</p>
<p>Below we show the common case where you start from
<code>(x, y, size)</code> with <code>delta = 1</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use the (x, y, size) form and let estimate_process_parameters() construct time via delta</span></span>
<span><span class="va">parameter_estimation_data</span> <span class="op">&lt;-</span> <span class="va">small_example_data</span></span>
<span></span>
<span><span class="co"># Define the integration / grid values used by the likelihood approximation</span></span>
<span><span class="va">x_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, length.out <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">y_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, length.out <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">t_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>,  length.out <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Parameter initialization values: (alpha1, beta1, gamma1, alpha2, beta2, alpha3, beta3, gamma3)</span></span>
<span><span class="va">parameter_inits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">8.5</span>, <span class="fl">0.015</span>, <span class="fl">1.5</span>, <span class="fl">3.2</span>, <span class="fl">0.75</span>, <span class="fl">3</span>, <span class="fl">0.08</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Upper bounds for (t, x, y)</span></span>
<span><span class="va">upper_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">25</span>, <span class="fl">25</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">fit_sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_process_parameters.html">estimate_process_parameters</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">parameter_estimation_data</span>,</span>
<span>  process <span class="op">=</span> <span class="st">"self_correcting"</span>,</span>
<span>  x_grid <span class="op">=</span> <span class="va">x_grid</span>,</span>
<span>  y_grid <span class="op">=</span> <span class="va">y_grid</span>,</span>
<span>  t_grid <span class="op">=</span> <span class="va">t_grid</span>,</span>
<span>  upper_bounds <span class="op">=</span> <span class="va">upper_bounds</span>,</span>
<span>  parameter_inits <span class="op">=</span> <span class="va">parameter_inits</span>,</span>
<span>  delta <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"global_local"</span><span class="op">)</span>,</span>
<span>  global_algorithm <span class="op">=</span> <span class="st">"NLOPT_GN_CRS2_LM"</span>,</span>
<span>  local_algorithm <span class="op">=</span> <span class="st">"NLOPT_LN_BOBYQA"</span>,</span>
<span>  global_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxeval <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>,</span>
<span>  local_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxeval <span class="op">=</span> <span class="fl">300</span>, xtol_rel <span class="op">=</span> <span class="fl">1e-5</span>, maxtime <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print method for ldmppr_fit objects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit_sc</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;ldmppr_fit&gt;</span></span>
<span><span class="co">#&gt;   process: self_correcting</span></span>
<span><span class="co">#&gt;   engine:  nloptr</span></span>
<span><span class="co">#&gt;   n_obs:   121</span></span>
<span><span class="co">#&gt;   delta*:  1</span></span>
<span><span class="co">#&gt;   objective(best): 157.7901</span></span>
<span><span class="co">#&gt;  optimal parameters: -2.35915611.212930.018337991.5852524.4480860.70535082.3648550.08446602</span></span>
<span></span>
<span><span class="co"># Extract parameters</span></span>
<span><span class="va">estimated_parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_sc</span><span class="op">)</span></span>
<span><span class="va">estimated_parameters</span></span>
<span><span class="co">#&gt; [1] -2.35915570 11.21293135  0.01833799  1.58525187  4.44808655  0.70535081</span></span>
<span><span class="co">#&gt; [7]  2.36485473  0.08446602</span></span></code></pre></div>
<p><strong>Notes</strong></p>
<ul>
<li>If you want to search over possible mappings between size and time,
provide <code>delta_values = c(...)</code> and set
<code>parallel = TRUE</code> to run one optimizer per delta (optionally
in parallel).</li>
<li>For better accuracy you typically want denser grids than in this
vignette example; the small grid here is chosen to keep runtime
modest.</li>
</ul>
</div>
<div class="section level3">
<h3 id="step-2-train-a-mark-model">Step 2: Train a mark model<a class="anchor" aria-label="anchor" href="#step-2-train-a-mark-model"></a>
</h3>
<p>Next, we use the <code>train_mark_model</code> function to train a
suitably flexible mark model using location-specific covariates
(rasters), (optionally) semi-distance dependent competition indices, and
the generated arrival times to predict sizes. The function uses
either:</p>
<ul>
<li>gradient boosted trees (<code>model_type = "xgboost"</code>),
or</li>
<li>random forest (<code>model_type = "ranger"</code>),</li>
</ul>
<p>and may be run in parallel if desired. The user has control over the
choice of a Gradient Boosting Machine (GBM) or Random Forest (RF) model,
the bounds of the spatial domain, the inclusion of competition indices,
the competition radius, the correction method, the final model selection
metric, the number of cross validation folds, and the size of the
parameter tuning grid for the model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load raster covariates shipped with the package</span></span>
<span><span class="va">raster_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"ldmppr"</span><span class="op">)</span>,</span>
<span>  pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">raster_paths</span> <span class="op">&lt;-</span> <span class="va">raster_paths</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_med\\.tif$"</span>, <span class="va">raster_paths</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">rasters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">raster_paths</span>, <span class="fu">terra</span><span class="fu">::</span><span class="va"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scale rasters once up front</span></span>
<span><span class="va">scaled_rasters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale_rasters.html">scale_rasters</a></span><span class="op">(</span><span class="va">rasters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Train the mark model, passing the estimated self-correcting model fit from Step 1</span></span>
<span><span class="va">mark_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_mark_model.html">train_mark_model</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">fit_sc</span>,</span>
<span>  raster_list <span class="op">=</span> <span class="va">scaled_rasters</span>,</span>
<span>  scaled_rasters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  model_type <span class="op">=</span> <span class="st">"xgboost"</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  include_comp_inds <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  competition_radius <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  edge_correction <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  selection_metric <span class="op">=</span> <span class="st">"rmse"</span>,</span>
<span>  cv_folds <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  tuning_grid_size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Training mark model</span></span>
<span><span class="co">#&gt;   Model type: xgboost</span></span>
<span><span class="co">#&gt;   Selection metric: rmse</span></span>
<span><span class="co">#&gt;   CV folds: 5</span></span>
<span><span class="co">#&gt;   Tuning grid size: 20</span></span>
<span><span class="co">#&gt;   Include competition indices: no</span></span>
<span><span class="co">#&gt;   Edge correction: none</span></span>
<span><span class="co">#&gt; Step 1/6: Preparing training data...</span></span>
<span><span class="co">#&gt;   Rows: 121</span></span>
<span><span class="co">#&gt;   Done in 0.0s.</span></span>
<span><span class="co">#&gt; Step 2/6: Configuring parallel backend...</span></span>
<span><span class="co">#&gt;   Parallel: off</span></span>
<span><span class="co">#&gt;   Model engine threads: 3</span></span>
<span><span class="co">#&gt;   Done in 0.0s.</span></span>
<span><span class="co">#&gt; Step 3/6: Extracting raster covariates...</span></span>
<span><span class="co">#&gt;   Using pre-scaled rasters (scaled_rasters = TRUE).</span></span>
<span><span class="co">#&gt;   Extracted 4 raster feature(s).</span></span>
<span><span class="co">#&gt;   Done in 0.0s.</span></span>
<span><span class="co">#&gt; Step 4/6: Building model matrix (and competition indices if requested)...</span></span>
<span><span class="co">#&gt;   Final training rows: 121</span></span>
<span><span class="co">#&gt;   Final feature columns (incl x,y,time): 7</span></span>
<span><span class="co">#&gt;   Done in 0.0s.</span></span>
<span><span class="co">#&gt; Step 5/6: Fitting model (with optional CV tuning)...</span></span>
<span><span class="co">#&gt;   Tuning enabled: 5-fold CV with 20 candidate(s).</span></span>
<span><span class="co">#&gt;   Total model fits: 100 (5 folds x 20 grid).</span></span>
<span><span class="co">#&gt;   Done in 27.7s.</span></span>
<span><span class="co">#&gt; Step 6/6: Finalizing output object...</span></span>
<span><span class="co">#&gt;   Done in 0.0s.</span></span>
<span><span class="co">#&gt; Training complete. Total time: 27.8s.</span></span>
<span></span>
<span><span class="co"># Print method for ldmppr_mark_model objects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mark_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;ldmppr_mark_model&gt;</span></span>
<span><span class="co">#&gt;   engine: xgboost</span></span>
<span><span class="co">#&gt;   has fit_engine: TRUE</span></span>
<span><span class="co">#&gt;   has xgb_raw: FALSE</span></span>
<span><span class="co">#&gt;   n_features: 7</span></span>
<span></span>
<span><span class="co"># Summary method for ldmppr_mark_model objects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mark_model</span><span class="op">)</span></span>
<span><span class="co">#&gt;               Length Class       Mode       </span></span>
<span><span class="co">#&gt; engine           1   -none-      character  </span></span>
<span><span class="co">#&gt; fit_engine    1158   xgb.Booster list       </span></span>
<span><span class="co">#&gt; xgb_raw          0   -none-      NULL       </span></span>
<span><span class="co">#&gt; recipe          12   recipe      list       </span></span>
<span><span class="co">#&gt; outcome          1   -none-      character  </span></span>
<span><span class="co">#&gt; feature_names    7   -none-      character  </span></span>
<span><span class="co">#&gt; info             7   -none-      list       </span></span>
<span><span class="co">#&gt; cache            0   -none-      environment</span></span></code></pre></div>
<p>If the user wants to save the trained mark model (and reload it at a
later time), the package provides the <code>save_mark_model</code> and
<code>load_mark_model</code> functions (which handle model-engine
specifics appropriately):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">save_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ldmppr_mark_model.html">save_mark_model</a></span><span class="op">(</span><span class="va">mark_model</span>, <span class="va">save_path</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mark_model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ldmppr_mark_model.html">load_mark_model</a></span><span class="op">(</span><span class="va">save_path</span><span class="op">)</span></span>
<span><span class="va">mark_model2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-3-check-model-fit">Step 3: Check model fit<a class="anchor" aria-label="anchor" href="#step-3-check-model-fit"></a>
</h3>
<p>Now that we have (i) an estimated process model and (ii) a trained
mark model, we can check the model fit using the
<code>check_model_fit</code> function. This function provides a variety
of non-parametric summaries for point processes and global envelope
tests to assess the goodness of fit of the model. The package provides
individual envelope tests for the L, F, G, J, E, and V statistics, or a
combined envelope test for all statistics simultaneously by making use
of the functionality of the <code>spatstat</code> and <code>GET</code>
packages. By plotting the combined envelope test, we can visually assess
the goodness of fit of the model and obtain a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value
measuring how well the estimated model captures the relationships
observed in the reference data. Typically a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value
less than 0.05 indicates a poor fit of the model to the data, and the
authors of the <code>GET</code> package recommend a minimum of 2500
simulations to obtain a valid
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value
at the .05 level.</p>
<p><code><a href="../reference/check_model_fit.html">check_model_fit()</a></code> returns an S3 object with a
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method (by default it plots the combined global
envelope test).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check the model fit by passing the estimated process and trained mark models from Steps 1 and 2</span></span>
<span><span class="va">model_check</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_model_fit.html">check_model_fit</a></span><span class="op">(</span></span>
<span>  t_min <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  t_max <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  process <span class="op">=</span> <span class="st">"self_correcting"</span>,</span>
<span>  process_fit <span class="op">=</span> <span class="va">fit_sc</span>,</span>
<span>  raster_list <span class="op">=</span> <span class="va">scaled_rasters</span>,</span>
<span>  scaled_rasters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mark_model <span class="op">=</span> <span class="va">mark_model</span>,</span>
<span>  include_comp_inds <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  thinning <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  edge_correction <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  competition_radius <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  n_sim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  save_sims <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">90210</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Registered S3 method overwritten by 'spatstat.geom':</span></span>
<span><span class="co">#&gt;   method       from     </span></span>
<span><span class="co">#&gt;   print.metric yardstick</span></span>
<span></span>
<span><span class="co"># Plot method for ldmppr_model_check objects (defaults to combined global envelope test)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_check</span><span class="op">)</span></span></code></pre></div>
<p><img src="ldmppr_howto_files/figure-html/check_model_fit-1.png" class="r-plt" alt="" width="864"></p>
<p>You can still access the underlying <code>GET</code> objects if you
want (e.g., <code>model_check$combined_env</code>), but for most
workflows <code>plot(model_check)</code> is sufficient.</p>
</div>
<div class="section level3">
<h3 id="step-4-simulate-from-the-fitted-model">Step 4: Simulate from the fitted model<a class="anchor" aria-label="anchor" href="#step-4-simulate-from-the-fitted-model"></a>
</h3>
<p>Finally, we can simulate a new marked point process realization from
the fitted model.</p>
<p><code><a href="../reference/simulate_mpp.html">simulate_mpp()</a></code> returns an object of class
<code>ldmppr_sim</code> with <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> and
<code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> methods.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate a new marked point pattern by passing the estimated process and trained mark models from Steps 1 and 2</span></span>
<span><span class="va">simulated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_mpp.html">simulate_mpp</a></span><span class="op">(</span></span>
<span>  process <span class="op">=</span> <span class="st">"self_correcting"</span>,</span>
<span>  process_fit <span class="op">=</span> <span class="va">fit_sc</span>,</span>
<span>  t_min <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  t_max <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  raster_list <span class="op">=</span> <span class="va">scaled_rasters</span>,</span>
<span>  scaled_rasters <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  mark_model <span class="op">=</span> <span class="va">mark_model</span>,</span>
<span>  include_comp_inds <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  competition_radius <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  edge_correction <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  thinning <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">90210</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot method for ldmppr_sim</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">simulated</span><span class="op">)</span></span></code></pre></div>
<p><img src="ldmppr_howto_files/figure-html/simulate_mpp-1.png" class="r-plt" alt="" width="624"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Data-frame view of the simulated realization</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">simulated</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        time         x         y    marks</span></span>
<span><span class="co">#&gt; 1 0.0000000 10.000000 14.000000 900.3945</span></span>
<span><span class="co">#&gt; 2 0.5665075  6.876867 11.000582 616.8078</span></span>
<span><span class="co">#&gt; 3 0.5681509 23.172989  5.596634 509.3947</span></span>
<span><span class="co">#&gt; 4 0.5888005 15.098973 22.274414 606.6250</span></span>
<span><span class="co">#&gt; 5 0.5888236  9.816135 12.080103 576.7651</span></span>
<span><span class="co">#&gt; 6 0.5995983  7.749460  7.628359 630.4380</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This vignette demonstrates the core <code>ldmppr</code> workflow
using the updated S3-based interfaces:</p>
<ul>
<li>
<code><a href="../reference/estimate_process_parameters.html">estimate_process_parameters()</a></code> → returns a fitted
process object (<code>ldmppr_fit</code>)</li>
<li>
<code><a href="../reference/train_mark_model.html">train_mark_model()</a></code> → returns a fitted mark model object
(<code>ldmppr_mark_model</code>)</li>
<li>
<code><a href="../reference/check_model_fit.html">check_model_fit()</a></code> → returns a model-check object
(<code>ldmppr_model_check</code>)</li>
<li>
<code><a href="../reference/simulate_mpp.html">simulate_mpp()</a></code> → returns a simulation object
(<code>ldmppr_sim</code>)</li>
</ul>
<p>These objects are designed to be composable and to behave like
standard R model objects through S3 methods.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lane Drew, Andee Kaplan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
